<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/FileSaver.js/2014-11-29/FileSaver.js"></script>
</head>

<body>
    <button onclick="getdata1(1)">获取全国Id、特性、身高、体重、属性、种族值、努力值、英文名、</button>
    <button onclick="getdata2(1)">获取...</button>
    <br>
    <button onclick="getdataX(1)">获取XXX</button>
    <br>
    <button onclick="save()">save</button>

    <table>
        <thead>
            <tr>
                <th>全国Id</th>
                <th>中文名称</th>
                <th>英文名称</th>
                <th>日文名称</th>
                <th>属性</th>
                <th>身高</th>
                <th>体重</th>
                <th>种类</th>
                <th>孵化周期</th>
                <th>特性</th>
                <th>蛋组</th>
                <th>种族值</th>
                <th>努力值</th>
                <th>形态</th>
            </tr>
        </thead>
        <tbody id='tbody'>

        </tbody>
    </table>
</body>
<script>
    //https://pokeapi.co/api/v2/evolution-chain/  进化链
    //https://pokeapi.co/api/v2/ability/ 特性表
    var 属性对照 = ['一般', '格斗', '飞行', '毒', '地面', '岩石', '虫', '幽灵', '钢', '火', '水', '草', '电', '超能力', '冰', '龙', '恶', '妖精']
    var 蛋组对照 = ['怪兽组', '水一组', '昆虫组', '飞行组', '陆上组', '妖精组', '植物组', '人形组', '水三组', '矿物组', '不定形组', '水二组', '百变怪', '龙组', '未发现组']
    var pokedata = []



    //获取全国Id、特性、身高、体重、属性、种族值、努力值、英文名
    //技能表和道具携带，没弄
    var getdata1 = (num) => {
        $.ajax({
            url: 'https://pokeapi.co/api/v2/pokemon/' + num,
            type: "GET",
            success: function (res) {
                return res
            }
        }).then(res => {
            console.log(res)
            pokedata[num - 1] = pokedata[num - 1] ? pokedata[num - 1] : {}

            let 全国Id = res.id
            let 身高 = res.height / 10    //m
            let 体重 = res.weight / 10    //kg
            let 英文名 = res.name

            let 特性 = [null, null, null]
            res.abilities.map(x => {
                特性[x.slot - 1] = x.ability.url.split('/')[6] * 1
            })


            let 属性 = [null, null]
            res.types.map(x => {
                属性[x.slot - 1] = 属性对照[x.type.url.split('/')[6] - 1]
            })

            let 种族值 = [];  //速，特防，特攻，防，攻，hp
            let 努力值 = [];
            res.stats.map(x => {
                种族值.push(x.base_stat);
                努力值.push(x.effort)
            })

            let poke = {
                '全国Id': 全国Id,
                '特性': 特性,
                '身高': 身高,
                '体重': 体重,
                '属性': 属性,
                '种族值': 种族值,
                '努力值': 努力值,
                '英文名': 英文名,
            }

            Object.assign(pokedata[num - 1], poke)
        }).then(() => getdata1(num + 1))
    }

    //获取种族、捕获率、初始亲密度、颜色
    //...没弄
    var getdata2 = (num) => {
        $.ajax({
            url: 'https://pokeapi.co/api/v2/pokemon-species/' + num,
            type: "GET",
            success: function (res) {
                return res
            }
        }).then(res => {
            console.log(res)
            pokedata[num - 1] = pokedata[num - 1] ? pokedata[num - 1] : {}

            let 种族 = res.genera[0].genus
            let 捕获率 = res.capture_rate
            let 初始亲密度 = res.base_happiness
            let 颜色 = res.color.name
            let 蛋组 = []
            res.egg_groups.map(x => {             
                蛋组.unshift(蛋组对照[x.url.split('/')[6]-1])
            })
            let 进化表 = res.evolution_chain.url.split('/')[6] * 1
            let 世代 = res.generation.name.split('-')[1].toUpperCase() 
            let 性别比 = res.gender_rate  //若不为-1,雌雄比 =[性别比例：8-性别比例];若为-1,无性别
            let 性别差异 = res.has_gender_differences
            let 形态切换 = res.forms_switchable //Mega、元素回归、达摩狒狒等
            let 形式描述 = res.form_descriptions //??
            let 孵化步数 = res.hatch_counter*257  //2570步
            let 幼年宝可梦 = res.is_baby
            let 中文名 = res.names[0].name
            let 日文名 = res.names[1].name
            let 英文名 = res.names[2].name

            let poke = {
                '种族': 种族,
                '捕获率': 捕获率,
                '初始亲密度': 初始亲密度,
                '颜色': 颜色,
                '蛋组': 蛋组,
                '进化表': 进化表,
                '世代':世代,
                '性别比':性别比,
                '性别差异':性别差异,
                '形态切换':形态切换,
                '形式描述':形式描述,
                '孵化步数':孵化步数,
                '幼年宝可梦':幼年宝可梦,
                '中文名':中文名,
                '日文名':日文名,
            }

            Object.assign(pokedata[num - 1], poke)

        }).then(() => getdata2(num + 1))
    }

    var getdataX = (num) => {
        $.ajax({
            url: 'https://pokeapi.co/api/v2/egg-group/' + num,
            type: "GET",
            success: function (res) {
                return res
            }
        }).then(res => {
            console.log(res)
            pokedata[num - 1] = res.name;
        }).then(() => getdataX(num + 1))
    }

    function save() {
        let content = JSON.stringify(pokedata);
        let blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        saveAs(blob, "save.json");
    }
</script>

</html>